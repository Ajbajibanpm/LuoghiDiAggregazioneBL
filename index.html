<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappatura Giovani Belluno</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="camera-modal">
    <video id="camera-stream" autoplay playsinline></video>
    <div class="camera-controls">
        <button class="btn-primary" style="width: 70px; height: 70px; border-radius: 50%;" onclick="captureSnapshot()">ðŸ“¸</button>
        <button class="btn-secondary" style="width: auto; padding: 0 20px;" onclick="stopCamera()">Annulla</button>
    </div>
</div>

<div class="container">
    <div id="personal-section" class="card">
        <h1>Benvenuto</h1>
        <div class="form-group"><label>Nome e Cognome *</label><input type="text" id="user-name" placeholder="Mario Rossi"></div>
        <div class="form-group"><label>Email *</label><input type="email" id="user-email" placeholder="mario@esempio.it"></div>
        <div class="form-group"><label>Data di Nascita *</label><input type="date" id="user-dob"></div>
        <button class="btn-primary" onclick="savePersonalData()">Inizia Mappatura</button>
    </div>

    <form id="place-form" class="card hidden">
        <div id="user-greeting" style="font-size: 0.75rem; color: var(--accent); font-weight: bold; margin-bottom: 1rem;"></div>

<!--SEZIONE 1: GENERALE-->
        <!--titolo-->
        <div class="section-title">Descrizione generale</div>
        <!--nome dello spazio-->
        <div class="form-group"><label>Nome dello spazio *</label><input type="text" id="place-name" placeholder="es. Skatepark Lambioi"></div>
        <!--descrizione dello spazio-->
        <div class="form-group">
            <label>Descrizione</label>
            <textarea id="place-desc" style="width:100%; height:80px; background:var(--input-bg); color:white; border:1px solid var(--border); border-radius:10px; padding:0.85rem;" placeholder="Racconta brevemente..."></textarea>
        </div>
        <!--foto-->
        <div class="form-group">
            <label>Foto dello spazio</label>
            <div class="photo-options">
                <button type="button" class="photo-btn" onclick="document.getElementById('photo-upload').click()">ðŸ“¸ Carica</button>
            </div>
            <input type="file" id="photo-upload" accept="image/*" class="hidden" onchange="handleFile(this)">
            <div id="preview-wrapper" class="preview-container"><img id="img-preview" class="preview-img"><button type="button" class="remove-photo" onclick="clearPhoto()">âœ•</button></div>
        </div>

        <!--SEZIONE 2: LOCALIZZAZIONE-->
        <!--titolo-->
        <div class="section-title">Localizzazione</div>
        <!--comune-->
        <div class="form-group">
            <label>Comune *</label>
            <select id="main-loc" onchange="populateSubLocs()"></select>
        </div>
            <!--frazione-->
        <div id="address-section" class="hidden">
            <div class="form-group">
                <label>Frazione / LocalitÃ  *</label>
                <select id="sub-loc" onchange="toggleOther(this, 'other-loc')" disabled></select>
                <input type="text" id="other-loc" class="other-input" placeholder="Specifica localitÃ ...">
            </div>
            <!--indirizzo specifico-->
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>Indirizzo specifico *</label>
                    <!--non conosci l'indirizzo?-->
                    <span class="map-link" onclick="openMapPicker()">Non conosci l'indirizzo?</span>
                </div>
                <input type="text" id="address" placeholder="es. Via Roma 12">
                <input type="hidden" id="manual-coords">
            </div>
        </div>
        
        <!--SEZIONE 3-->
        <div class="section-title">Tipologia</div>
        <div class="form-group">
            <label>Categoria *</label>
            <select id="macro-type" onchange="updateSubTypes()">
                <option value="" disabled selected>Seleziona categoria...</option>
                <option value="pubblici">1. Spazi Pubblici e Aperti</option>
                <option value="aggregazione">2. Centri di Aggregazione</option>
                <option value="commerciali">3. Spazi Commerciali</option>
                <option value="transito">4. Spazi di Transito</option>
            </select>
        </div>
        <div id="sub-type-container" class="form-group hidden">
            <label>Dettaglio Tipologia *</label>
            <select id="sub-type" onchange="toggleOther(this, 'other-subtype')"></select>
            <input type="text" id="other-subtype" class="other-input" placeholder="Descrivi il tipo...">
        </div>

        <!--SEZIONE 4-->
        <div class="section-title">Gestione e Contatti</div>
        <div class="form-group">
            <label>Chi lo gestisce? *</label>
            <select id="management" onchange="toggleManagementName(); toggleOther(this, 'other-mgmt')">
                <option value="" disabled selected>Seleziona...</option>
                <option value="Amministrazione Pubblica">Amministrazione Pubblica</option>
                <option value="Ente Religioso">Ente Religioso</option>
                <option value="Impresa o Soggetto Privato">Impresa o Soggetto Privato</option>
                <option value="Associazione o Cooperativa Sociale">Associazione o Cooperativa Sociale</option>
                <option value="non_so">Non lo so</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="management-name" class="other-input" placeholder="Nome specifico gestore...">
            <input type="text" id="other-mgmt" class="other-input" placeholder="Specifica tipo gestione...">
        </div>

        <div class="form-group">
            <label>Social e Sito Web (max 5)</label>
            <div id="social-container">
                <div class="social-row"><input type="url" class="social-link" placeholder="https://..."></div>
            </div>
            <button type="button" id="add-social" class="btn-add" onclick="addSocialField()">+ Aggiungi link</button>
        </div>

        <!--SEZIONE X: ???-->
        <div class="section-title">Media e Descrizione</div>
        <div class="form-group">
            <label>Domanda X</label>
            <div class="form-group">
            <label>Domanda X *</label>
            <select id="domanda-x" onchange="eventualeFunzione()"></select>
        </div>
        </div>

        <!--INVIO FORM-->
        <button type="button" class="btn-primary" onclick="submitForm()">Registra Luogo</button>
        
    
    </form>

    <div id="success-screen" class="card hidden" style="text-align:center;">
        <h2 style="color: var(--accent);">Luogo Mappato!</h2>
        <p style="font-size: 0.8rem; color: var(--muted);">Posizione confermata sulla mappa.</p>
        <div id="map"></div>
        <button class="btn-primary" onclick="location.reload()">Aggiungi un altro</button>
        <button class="btn-secondary" onclick="resetUser()">Esci</button>
    </div>
</div>

<div id="map-picker-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:2000; flex-direction:column;">
    <div style="padding:20px; text-align:center;">
        <p>Tocca il punto esatto sulla mappa</p>
        <div id="picker-map" style="width:100%; height:70vh; border-radius:15px; border:1px solid var(--border);"></div>
        <button class="btn-primary" onclick="confirmPicker()" style="margin-top:20px;">Conferma Posizione</button>
        <button class="btn-secondary" onclick="closeMapPicker()">Annulla</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="script.js"></script>
</body>
</html>
