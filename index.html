<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappatura Giovani Belluno</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.15);
            --text: #f1f5f9;
            --muted: #94a3b8;
            --input-bg: #0f172a;
            --border: #334155;
        }
        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .container { max-width: 480px; width: 100%; }
        .card { 
            background: var(--card); 
            padding: 2.5rem; 
            border-radius: 20px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }
        .section-title { 
            color: var(--accent); 
            font-size: 0.75rem; 
            font-weight: 700;
            text-transform: uppercase; 
            letter-spacing: 0.1em; 
            margin: 2rem 0 1rem; 
            display: flex;
            align-items: center;
        }
        .section-title::after {
            content: "";
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, var(--border), transparent);
            margin-left: 1rem;
        }
        .form-group { margin-bottom: 1.25rem; }
        label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text); }
        
        select, input { 
            width: 100%; 
            padding: 0.85rem; 
            border-radius: 10px; 
            border: 1px solid var(--border); 
            background: var(--input-bg); 
            color: white; 
            box-sizing: border-box; 
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }
        select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .file-input-container {
            position: relative;
            width: 100%;
            height: 120px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(15, 23, 42, 0.3);
        }
        .file-input-container:hover { border-color: var(--accent); background: var(--accent-glow); }
        .file-input-container input { opacity: 0; position: absolute; width: 100%; height: 100%; cursor: pointer; }
        .file-label { color: var(--muted); font-size: 0.85rem; pointer-events: none; }
        .preview-img { display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        
        .other-input { margin-top: 0.75rem; display: none; border-color: var(--accent); }
        
        button { 
            width: 100%; 
            padding: 1rem; 
            border-radius: 12px; 
            border: none; 
            font-weight: 700; 
            cursor: pointer; 
        }
        .btn-primary { 
            background: var(--accent); 
            color: #0f172a; 
            margin-top: 1.5rem;
            box-shadow: 0 4px 14px 0 rgba(56, 189, 248, 0.39);
        }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        
        .btn-secondary { 
            background: transparent; 
            color: var(--muted); 
            border: 1px solid var(--border); 
            margin-top: 1rem; 
            font-size: 0.85rem; 
        }
        
        .hidden { display: none; }
        .summary-box { 
            background: rgba(15, 23, 42, 0.5); 
            padding: 1.5rem; 
            border-radius: 12px; 
            text-align: left; 
            margin: 1.5rem 0; 
            border-left: 3px solid var(--accent);
        }
        .summary-item { margin-bottom: 0.8rem; }
        .summary-label { color: var(--muted); font-size: 0.65rem; text-transform: uppercase; display: block; margin-bottom: 0.2rem; }
        .summary-value { font-weight: 500; }
    </style>
</head>
<body>

<div class="container">
    <div id="personal-section" class="card">
        <h1 style="margin-top:0; font-size: 1.5rem;">Benvenuto</h1>
        <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 2rem;">Configura il tuo profilo per iniziare la mappatura.</p>
        
        <div class="form-group"><label>Nome e Cognome</label><input type="text" id="user-name" placeholder="Mario Rossi"></div>
        <div class="form-group"><label>Email</label><input type="email" id="user-email" placeholder="mario@esempio.it"></div>
        <div class="form-group"><label>Data di Nascita</label><input type="date" id="user-dob"></div>
        <div class="form-group">
            <label>Dove vivi?</label>
            <select id="user-origin" required>
                <option value="" disabled selected>Seleziona provenienza...</option>
                <option value="Area Belluno">Area Belluno</option>
                <option value="Area Feltre">Area Feltre</option>
                <option value="Cadore / Ampezzo / Comelico">Cadore / Ampezzo / Comelico</option>
                <option value="Agordino">Agordino</option>
                <option value="Fuori Provincia (BL)">Fuori Provincia</option>
                <option value="Fuori Regione (Veneto)">Fuori Regione</option>
                <option value="Estero">Estero</option>
            </select>
        </div>
        <button class="btn-primary" onclick="savePersonalData()">Inizia Mappatura</button>
    </div>

    <form id="place-form" class="card hidden">
        <div id="user-greeting" style="font-size: 0.75rem; color: var(--accent); font-weight: bold; background: var(--accent-glow); padding: 4px 12px; border-radius: 20px; display: inline-block; margin-bottom: 1rem;"></div>

        <div class="section-title">Localizzazione</div>
        <div class="form-group">
            <label>Comune</label>
            <select id="main-loc" onchange="populateSubLocs()" required></select>
        </div>
        <div class="form-group">
            <label>Frazione / Localit√†</label>
            <select id="sub-loc" onchange="toggleOther(this, 'other-loc')" required disabled></select>
            <input type="text" id="other-loc" class="other-input" placeholder="Specifica localit√†...">
        </div>
        
        <div class="form-group"><label>Nome dello spazio</label><input type="text" id="place-name" placeholder="es. Skatepark Lambioi" required></div>

        <div class="form-group">
            <label>Foto dello spazio</label>
            <div class="file-input-container" id="file-drop-zone">
                <input type="file" id="place-photo" accept="image/*" capture="environment" onchange="handleFile(this)">
                <div id="file-label-group" style="text-align: center;">
                    <span style="font-size: 1.5rem;">üì∏</span><br>
                    <span class="file-label">Scatta o carica una foto</span>
                </div>
                <img id="img-preview" class="preview-img">
            </div>
        </div>

        <div class="section-title">Dettagli Luogo</div>
        <div class="form-group">
            <label>Tipologia di Spazio</label>
            <select id="macro-type" onchange="updateSubTypes()" required>
                <option value="" disabled selected>Seleziona categoria...</option>
                <option value="pubblici">1. Spazi Pubblici e Aperti (es. parchi, piazze)</option>
                <option value="aggregazione">2. Centri di Aggregazione (es. oratori, hub)</option>
                <option value="commerciali">3. Spazi Commerciali (es. bar, cinema)</option>
                <option value="transito">4. Spazi di Transito (es. stazioni, parcheggi)</option>
            </select>
            <select id="sub-type" class="other-input" style="margin-top:0.75rem;" onchange="toggleOther(this, 'other-subtype')" required></select>
            <input type="text" id="other-subtype" class="other-input" placeholder="Descrivi il tipo di spazio...">
        </div>

        <div class="form-group">
            <label>Gestione</label>
            <select id="management" onchange="toggleManagementName(); toggleOther(this, 'other-mgmt')" required>
                <option value="" disabled selected>Chi lo gestisce?</option>
                <option value="Amministrazione Pubblica">Amministrazione Pubblica</option>
                <option value="Ente Religioso">Ente Religioso</option>
                <option value="Impresa o Soggetto Privato">Impresa o Soggetto Privato</option>
                <option value="Associazione o Cooperativa Sociale">Associazione o Cooperativa Sociale</option>
                <option value="Gruppo Autogestito o Informale">Gruppo Autogestito o Informale</option>
                <option value="non_so">Non lo so</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="management-name" class="other-input" placeholder="Inserisci il nome del gestore...">
            <input type="text" id="other-mgmt" class="other-input" placeholder="Specifica tipo di gestione...">
        </div>

        <button type="button" class="btn-primary" onclick="submitForm()">Registra Luogo</button>
        <button type="button" class="btn-secondary" onclick="resetUser()">Cambia Profilo</button>
    </form>

    <div id="success-screen" class="card hidden" style="text-align:center;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üìç</div>
        <h2 style="color: var(--accent); margin-bottom: 0.5rem;">Luogo Mappato!</h2>
        <div id="summary-container" class="summary-box"></div>
        <button class="btn-primary" onclick="newEntry()">Aggiungi un altro luogo</button>
        <button class="btn-secondary" onclick="resetUser()">Esci</button>
    </div>
</div>

<script>
    const locationData = {
        "Belluno": ["Antole", "Bolzano Bellunese", "Castion", "Cavessago", "Cet", "Chiesurazza", "Faverga", "Fiammoi", "Giamosa", "Giazzoi", "Levego", "Madeago", "Mier", "Nevegal", "Orzes", "Pedeserva", "Pra de Lante", "Rivamaor", "Sagrogna", "Sala", "Salce", "San Pietro in Campo", "Sopracroda", "Sois", "Sossai", "Tisoi", "Vezzano", "Vignole", "Visome"],
        "Feltre": ["Anz√π", "Arson", "Canal di Limana", "Cart", "Fastro", "Foen", "Lasen", "Mugnai", "Nemeggio", "Pont", "Pren", "Tomo", "Umin", "Vellai", "Vignui", "Villabruna", "Villapaiera", "Zermen"],
        "Borgo Valbelluna": ["Mel", "Trichiana", "Lentiai", "Carve", "Cesana", "Col di Mel", "Confos", "Farra", "Marcador", "Morgan", "Nave", "Pellegai", "Ronchena", "Sant‚ÄôAntonio Tortal", "Stabie", "Villa di Villa"],
        "Sedico": ["Bribano", "Libano", "Roe Alte", "Roe Basse", "Mas", "Peron", "Seghe di Villa", "Gresane"],
        "Alpago": ["Bastia", "Cornei", "Farra", "Garna", "Pieve", "Puos", "Sitran", "Tignes", "Torres", "Villa"],
        "Ponte nelle Alpi": ["Cadola", "Canevoi", "Casan", "Col di Cugnan", "Cornolade", "Cugnan", "Lastreghe", "Paiane", "Polpet", "Quantin", "Revelin", "Roncan", "Soccher"],
        "Cortina d‚ÄôAmpezzo": ["Acquabona", "Alver√†", "Campo di Sopra", "Chiave", "Col", "Grava", "Mortisa", "Pecol", "Socol", "Verocai", "Zuel"],
        "Agordo": ["Bries", "Brugnach", "Parech", "Prompicai", "Rif", "Toccol", "Valcozzena"],
        "Longarone": ["Castellavazzo", "Codissago", "Fortogna", "Igne", "Pirago", "Rivalta", "Roggia"],
        "Santa Giustina": ["Cergnai", "Formegan", "Meano", "Ignan", "Sartena"],
        "Limana": ["Can√®", "Cesa", "Coi di Navasa", "Dussoi", "Polentes", "Valmorel", "Triches"],
        "Pieve di Cadore": ["Nebbi√π", "Pozzale", "Sottocastello", "Tai di Cadore"],
        "Auronzo di Cadore": ["Misurina", "Reane", "San Marco", "Villapiccola", "Villagrande"],
        "Val di Zoldo": ["Forno", "Dont", "Fusine", "Mareson", "Pecol", "Pieve", "Coi"],
        "Cesiomaggiore": ["Alivie", "Busche", "Cesiola", "Col San Vito", "Cullagne", "Dorgnan", "Marsiai", "Menin", "Molinello", "Montagne", "Morzanch", "Nezze", "Pez", "Pullir", "Soranzen", "Toschian"],
        "Pedavena": ["Facen", "Murle", "Norcen", "Teven", "Travagola"],
        "Arsi√®": ["Fastro", "Incino", "Mellame", "Rocca", "Rivai", "San Vito"],
        "Sospirolo": ["Gron", "Maras", "Mis", "Oregne", "Pascoli", "San Gottardo"],
        "Sovramonte": ["Aune", "Faller", "Molinello", "Moline", "Servo", "Sorriva", "Zorzoi"],
        "Quero Vas": ["Caorera", "Carpen", "Quero", "Santa Maria", "Schievenin", "Vas"]
    };

    const categoryData = {
        "pubblici": ["Aree verdi e Parchi", "Piazze e Spazi pedonali", "Sport all‚Äôaperto", "Sosta informale"],
        "aggregazione": ["Hub creativi e Co-working", "Biblioteche e Aule studio", "Spazi Associativi e Religiosi", "Centri Giovani Istituzionali"],
        "commerciali": ["Locali di Ristorazione", "Centri Commerciali", "Divertimento e Spettacolo", "Impianti Sportivi Privati"],
        "transito": ["Nodi di Trasporto", "Aree di Risulta e Parcheggi", "Luoghi Dismessi o Abbandonati"]
    };

    const mainSel = document.getElementById('main-loc');
    mainSel.innerHTML = '<option value="" disabled selected>Scegli Comune...</option>';
    Object.keys(locationData).sort().forEach(loc => {
        let opt = document.createElement('option');
        opt.value = loc; opt.textContent = loc;
        mainSel.appendChild(opt);
    });

    function handleFile(input) {
        const preview = document.getElementById('img-preview');
        const label = document.getElementById('file-label-group');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                preview.src = e.target.result;
                preview.style.display = 'block';
                label.style.display = 'none';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function populateSubLocs() {
        const subSel = document.getElementById('sub-loc');
        const selectedCity = mainSel.value;
        subSel.innerHTML = '<option value="" disabled selected>Scegli Localit√†...</option>';
        if (selectedCity) {
            let centerOpt = document.createElement('option');
            centerOpt.value = selectedCity + " Centro";
            centerOpt.textContent = selectedCity + " Centro";
            subSel.appendChild(centerOpt);
            locationData[selectedCity].sort().forEach(s => {
                let opt = document.createElement('option');
                opt.value = s; opt.textContent = s;
                subSel.appendChild(opt);
            });
            subSel.innerHTML += '<option value="altro">Altro...</option>';
            subSel.disabled = false;
        }
    }

    function updateSubTypes() {
        const macro = document.getElementById('macro-type').value;
        const subSel = document.getElementById('sub-type');
        subSel.innerHTML = '<option value="" disabled selected>Scegli sottotipologia...</option>';
        if (categoryData[macro]) {
            categoryData[macro].forEach(text => {
                let opt = document.createElement('option');
                opt.value = text; opt.textContent = text;
                subSel.appendChild(opt);
            });
            subSel.innerHTML += '<option value="altro">Altro...</option>';
            subSel.style.display = 'block';
            subSel.required = true;
        }
    }

    function toggleManagementName() {
        const mgmtVal = document.getElementById('management').value;
        const nameInput = document.getElementById('management-name');
        nameInput.style.display = (mgmtVal && !['non_so', 'altro'].includes(mgmtVal)) ? 'block' : 'none';
        nameInput.required = nameInput.style.display === 'block';
    }

    function toggleOther(select, inputId) {
        const input = document.getElementById(inputId);
        input.style.display = (select.value === "altro") ? "block" : "none";
        input.required = (select.value === "altro");
    }

    function savePersonalData() {
        const nome = document.getElementById('user-name').value;
        const email = document.getElementById('user-email').value;
        const dob = document.getElementById('user-dob').value;
        const origin = document.getElementById('user-origin').value;
        if (!nome || !email || !dob || !origin) return alert("Completa il tuo profilo");
        localStorage.setItem('user_data', JSON.stringify({nome, email, dob, origin}));
        showForm(nome);
    }

    function checkUserStatus() {
        const saved = localStorage.getItem('user_data');
        if (saved) showForm(JSON.parse(saved).nome);
    }

    function showForm(name) {
        document.getElementById('personal-section').classList.add('hidden');
        document.getElementById('success-screen').classList.add('hidden');
        document.getElementById('place-form').classList.remove('hidden');
        document.getElementById('user-greeting').innerText = name;
    }

    function submitForm() {
        const form = document.getElementById('place-form');
        if(!form.checkValidity()) { form.reportValidity(); return; }
        const getVal = (id, otherId) => {
            const s = document.getElementById(id);
            return s.value === "altro" ? document.getElementById(otherId).value : s.value;
        };
        const summaryHTML = `
            <div class="summary-item"><span class="summary-label">Luogo</span><span class="summary-value">${document.getElementById('place-name').value}</span></div>
            <div class="summary-item"><span class="summary-label">Zona</span><span class="summary-value">${getVal('sub-loc', 'other-loc')} (${mainSel.value})</span></div>
            <div class="summary-item"><span class="summary-label">Tipologia</span><span class="summary-value">${getVal('sub-type', 'other-subtype')}</span></div>
        `;
        document.getElementById('summary-container').innerHTML = summaryHTML;
        document.getElementById('place-form').classList.add('hidden');
        document.getElementById('success-screen').classList.remove('hidden');
    }

    function newEntry() {
        document.getElementById('place-form').reset();
        document.getElementById('img-preview').style.display = 'none';
        document.getElementById('file-label-group').style.display = 'block';
        document.querySelectorAll('.other-input').forEach(i => i.style.display = 'none');
        checkUserStatus();
    }

    function resetUser() {
        localStorage.removeItem('user_data');
        location.reload();
    }

    window.onload = checkUserStatus;
</script>
</body>
</html>
