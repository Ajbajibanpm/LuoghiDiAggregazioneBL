<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappatura Giovani Belluno</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
            --text: #f1f5f9;
            --muted: #94a3b8;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container { max-width: 500px; width: 100%; }
        .card { background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .section-title { color: var(--accent); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin: 1.5rem 0 1rem; border-bottom: 1px solid #334155; padding-bottom: 0.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input, select { width: 100%; padding: 0.75rem; border-radius: 6px; border: 1px solid #334155; background: var(--bg); color: white; box-sizing: border-box; font-size: 0.95rem; }
        .other-input { margin-top: 0.75rem; display: none; border-color: var(--accent); }
        button { width: 100%; padding: 1rem; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--accent); color: var(--bg); margin-top: 1rem; }
        .btn-secondary { background: transparent; color: var(--muted); border: 1px solid var(--muted); margin-top: 0.5rem; font-size: 0.8rem; }
        .hidden { display: none; }
        .context-info { font-size: 0.85rem; color: var(--muted); margin-bottom: 1.5rem; line-height: 1.4; }
        .summary-box { background: #0f172a; padding: 1rem; border-radius: 8px; text-align: left; margin-bottom: 1.5rem; font-size: 0.9rem; border-left: 4px solid var(--accent); }
        .summary-item { margin-bottom: 0.6rem; border-bottom: 1px solid #1e293b; padding-bottom: 0.3rem; }
        .summary-label { color: var(--muted); font-size: 0.7rem; text-transform: uppercase; display: block; margin-bottom: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div id="personal-section" class="card">
        <div class="section-title">Profilo Utente</div>
        <p class="context-info">Il tuo contributo è essenziale per mappare gli spazi di aggregazione nella provincia di Belluno.</p>
        <div class="form-group"><label>Nome e Cognome</label><input type="text" id="user-name"></div>
        <div class="form-group"><label>Email</label><input type="email" id="user-email"></div>
        <div class="form-group"><label>Data di Nascita</label><input type="date" id="user-dob"></div>
        <button class="btn-primary" onclick="savePersonalData()">Inizia Mappatura</button>
    </div>

    <form id="place-form" class="card hidden">
        <div id="user-greeting" style="font-size: 0.8rem; color: var(--accent); margin-bottom: 1rem;"></div>

        <div class="section-title">Informazioni Luogo</div>
        <div class="form-group"><label>Nome dello spazio</label><input type="text" id="place-name" required></div>

        <div class="form-group">
            <label>Comune</label>
            <select id="main-loc" onchange="populateSubLocs()" required></select>
        </div>

        <div class="form-group">
            <label>Frazione / Località</label>
            <select id="sub-loc" onchange="toggleOther(this, 'other-loc')" required disabled></select>
            <input type="text" id="other-loc" class="other-input" placeholder="Specifica località...">
        </div>
        
        <div class="section-title">Classificazione</div>
        <div class="form-group">
            <label>Tipologia</label>
            <select id="place-type" onchange="toggleOther(this, 'other-type')" required>
                <option value="" disabled selected>Seleziona tipologia...</option>
                <option value="Istituzionale">Istituzionale (Informagiovani, Biblioteche, Centri aggregazione)</option>
                <option value="Informale">Informale (Piazze, Parchi, Muretti, Parchi gioco)</option>
                <option value="Commerciale">Commerciale (Bar, Pub, Centri commerciali, Sale giochi)</option>
                <option value="Sportivo">Sportivo (Campetti, Skatepark, Palestre)</option>
                <option value="Culturale/Associativo">Culturale/Associativo (Circoli, Centri sociali, Sale prove)</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="other-type" class="other-input" placeholder="Specifica tipologia...">
        </div>

        <div class="form-group">
            <label>Gestione</label>
            <select id="mgmt" onchange="toggleOther(this, 'other-mgmt')" required>
                <option value="" disabled selected>Seleziona gestione...</option>
                <option value="Comune / Ente Pubblico">Comune / Ente Pubblico</option>
                <option value="Associazione / Parrocchia">Associazione / Parrocchia</option>
                <option value="Privato">Privato</option>
                <option value="Gruppo autorganizzato">Gruppo autorganizzato</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="other-mgmt" class="other-input" placeholder="Specifica gestione...">
        </div>

        <div class="form-group">
            <label>Modalità di Accesso</label>
            <select id="access" onchange="toggleOther(this, 'other-access')" required>
                <option value="" disabled selected>Seleziona accesso...</option>
                <option value="Libero/Gratuito">Libero/Gratuito</option>
                <option value="Tessera/Iscrizione">Tessera/Iscrizione</option>
                <option value="Solo consumazione">Solo consumazione</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="other-access" class="other-input" placeholder="Specifica accesso...">
        </div>

        <div class="section-title">Esperienza Personale</div>
        <div class="form-group">
            <label>Il tuo ruolo</label>
            <select id="user-role" onchange="toggleOther(this, 'other-role')" required>
                <option value="" disabled selected>Seleziona ruolo...</option>
                <option value="Studente">Studente</option>
                <option value="Lavoratore">Lavoratore</option>
                <option value="Attivista / Volontario">Attivista / Volontario</option>
                <option value="Residente">Residente</option>
                <option value="altro">Altro...</option>
            </select>
            <input type="text" id="other-role" class="other-input" placeholder="Specifica ruolo...">
        </div>

        <button type="button" class="btn-primary" onclick="submitForm()">Invia Risposta</button>
        <button type="button" class="btn-secondary" onclick="resetUser()">Cambia Utente (Reset)</button>
    </form>

    <div id="success-screen" class="card hidden" style="text-align:center;">
        <h2 style="color: var(--accent)">Registrazione Completata</h2>
        <div id="summary-container" class="summary-box"></div>
        <p>Grazie per il tuo contributo alla provincia di Belluno.</p>
        <button class="btn-primary" onclick="newEntry()">Inserisci un altro luogo</button>
        <button class="btn-secondary" onclick="window.close()">Esci</button>
    </div>
</div>

<script>
    const locationData = {
        "Belluno (Capoluogo)": ["Antole", "Bolzano Bellunese", "Caviola", "Castion", "Cavessago", "Cet", "Chiesurazza", "Faverga", "Fiammoi", "Giamosa", "Giazzoi", "Levego", "Madeago", "Miér", "Nevegal", "Orzes", "Pedeserva", "Pra de Lante", "Rivamaor", "Sagrogna", "Sala", "Salce", "San Pietro in Campo", "Sopracroda", "Sois", "Sossai", "Tisoi", "Vezzano", "Vignole", "Visome"],
        "Feltre": ["Anzù", "Arson", "Canal di Limana", "Cart", "Fastro", "Foen", "Lasen", "Mugnai", "Nemeggio", "Pont", "Pren", "Tomo", "Umin", "Vellai", "Vignui", "Villabruna", "Villapaiera", "Zermen"],
        "Borgo Valbelluna": ["Mel", "Trichiana", "Lentiai", "Carve", "Cesana", "Col di Mel", "Confos", "Farra", "Marcador", "Morgan", "Nave", "Pellegai", "Ronchena", "Sant'Antonio Tortal", "Stabie", "Villa di Villa"],
        "Sedico": ["Bribano", "Libano", "Roe Alte", "Roe Basse", "Mas", "Peron", "Seghe di Villa", "Gresane"],
        "Santa Giustina": ["Cergnai", "Formegan", "Meano", "Ignan", "Sartena"],
        "Limana": ["Canè", "Cesa", "Coi di Navasa", "Dussoi", "Polentes", "Valmorel", "Triches"],
        "Alpago": ["Farra", "Pieve", "Puos", "Bastia", "Cornei", "Garna", "Sitran", "Tignes", "Torres", "Villa"],
        "Cortina d'Ampezzo": ["Acquabona", "Alverà", "Campo di Sopra", "Chiave", "Col", "Cortina", "Grava", "Mortisa", "Pecol", "Socol", "Verocai", "Zuel"],
        "Pieve di Cadore": ["Nebbiù", "Pozzale", "Sottocastello", "Tai di Cadore"],
        "Auronzo di Cadore": ["Misurina", "Reane", "San Marco", "Villapiccola", "Villagrande"],
        "Santo Stefano di Cadore": ["Campolongo", "Casada", "Costalissoio"],
        "San Pietro di Cadore": ["Costalta", "Presenaio", "Valle"],
        "Calalzo di Cadore": ["Rizzios"],
        "Vigo di Cadore": ["Laggio", "Pelos", "Pinié"],
        "Agordo": ["Bries", "Brugnach", "Parech", "Prompicai", "Rif", "Toccol", "Valcozzena"],
        "Alleghe": ["Caprile", "Santa Maria delle Grazie", "Sala", "Tos"],
        "Falcade": ["Caviola", "Molino", "Sappade", "Somor"],
        "Rocca Pietore": ["Digonera", "Laste", "Malga Ciapela", "Sottoguda"],
        "Canale d'Agordo": ["Carfon", "Feder", "Garés"],
        "Val di Zoldo": ["Forno", "Dont", "Fusine", "Mareson", "Pecol", "Pieve", "Coi"],
        "Longarone": ["Castellavazzo", "Codissago", "Fortogna", "Igne", "Pirago", "Rivalta", "Roggia"],
        "Ponte nelle Alpi": ["Cadola", "Canevoi", "Casan", "Col di Cugnan", "Cornolade", "Cugnan", "Lastreghe", "Paiane", "Polpet", "Quantin", "Revelin", "Roncan", "Soccher"],
        "Chies d'Alpago": ["Lamosano", "San Martino", "Funes"],
        "Tambre": ["All’Alpago", "Broz", "Sant'Anna"]
    };

    const mainSel = document.getElementById('main-loc');
    const subSel = document.getElementById('sub-loc');

    mainSel.innerHTML = '<option value="" disabled selected>Seleziona Comune...</option>';
    Object.keys(locationData).sort().forEach(loc => {
        let opt = document.createElement('option');
        opt.value = loc;
        opt.textContent = loc;
        mainSel.appendChild(opt);
    });

    function populateSubLocs() {
        const selected = mainSel.value;
        subSel.innerHTML = '<option value="" disabled selected>Seleziona Località...</option>';
        if (selected && locationData[selected]) {
            locationData[selected].forEach(s => {
                let opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                subSel.appendChild(opt);
            });
            let otherOpt = document.createElement('option');
            otherOpt.value = "altro";
            otherOpt.textContent = "Altro...";
            subSel.appendChild(otherOpt);
            subSel.disabled = false;
        }
    }

    function toggleOther(select, inputId) {
        const input = document.getElementById(inputId);
        if(select.value === "altro") {
            input.style.display = "block";
            input.required = true;
        } else {
            input.style.display = "none";
            input.required = false;
        }
    }

    function savePersonalData() {
        const nome = document.getElementById('user-name').value;
        if (!nome || !document.getElementById('user-email').value || !document.getElementById('user-dob').value) return alert("Dati incompleti");
        localStorage.setItem('user_data', JSON.stringify({nome}));
        showForm(nome);
    }

    function showForm(name) {
        document.getElementById('personal-section').classList.add('hidden');
        document.getElementById('success-screen').classList.add('hidden');
        document.getElementById('place-form').classList.remove('hidden');
        document.getElementById('user-greeting').innerText = "Sessione di: " + name;
    }

    function getVal(id, otherId) {
        const sel = document.getElementById(id);
        return sel.value === "altro" ? document.getElementById(otherId).value : sel.value;
    }

    function submitForm() {
        if(!document.getElementById('place-form').checkValidity()) return alert("Per favore, compila tutti i campi richiesti.");

        const summaryHTML = `
            <div class="summary-item"><span class="summary-label">Nome Luogo</span>${document.getElementById('place-name').value}</div>
            <div class="summary-item"><span class="summary-label">Ubicazione</span>${getVal('sub-loc', 'other-loc')} (${document.getElementById('main-loc').value})</div>
            <div class="summary-item"><span class="summary-label">Tipologia</span>${getVal('place-type', 'other-type')}</div>
            <div class="summary-item"><span class="summary-label">Gestione</span>${getVal('mgmt', 'other-mgmt')}</div>
            <div class="summary-item"><span class="summary-label">Accesso</span>${getVal('access', 'other-access')}</div>
            <div class="summary-item"><span class="summary-label">Ruolo</span>${getVal('user-role', 'other-role')}</div>
        `;
        
        document.getElementById('summary-container').innerHTML = summaryHTML;
        document.getElementById('place-form').classList.add('hidden');
        document.getElementById('success-screen').classList.remove('hidden');
    }

    function newEntry() {
        document.getElementById('place-form').reset();
        document.querySelectorAll('.other-input').forEach(i => i.style.display = 'none');
        subSel.disabled = true;
        showForm(JSON.parse(localStorage.getItem('user_data')).nome);
    }

    function resetUser() {
        localStorage.removeItem('user_data');
        location.reload();
    }

    window.onload = () => {
        const saved = localStorage.getItem('user_data');
        if (saved) showForm(JSON.parse(saved).nome);
    };
</script>
</body>
</html>
